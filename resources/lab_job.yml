# The main job for lab.
resources:
  jobs:
    lab_job:
      name: lab_job

    #  trigger:
    #    # Run this job every day, exactly one day from the last run; see https://docs.databricks.com/api/workspace/jobs/create#trigger
    #    periodic:
    #      interval: 1
    #      unit: DAYS

      #email_notifications:
      #  on_failure:
      #    - your_email@example.com

      tasks:
        - task_key: create_bronze_parquet
          job_cluster_key: job_cluster
          notebook_task:
            notebook_path: ../src/table creation/1_createhistbronzeparquets.py

      tasks:
        - task_key: create_silver_table
          depends_on: 
          - create_bronze_parquet
          job_cluster_key: job_cluster
          notebook_task:
            notebook_path: ../src/table creation/2b_createsilverbandtables.sql

      tasks:
        - task_key: load_bronze_to_silver
          depends_on: 
          - create_silver_table
          job_cluster_key: job_cluster
          notebook_task:
            notebook_path: ../src/data load/2c_moveToSilverHist.py
      

      job_clusters:
        - job_cluster_key: job_cluster
          new_cluster:
            spark_version: 16.4.x-scala2.12
            node_type_id: Standard_D3_v2
            is_single_node: true
            data_security_mode: SINGLE_USER
        
